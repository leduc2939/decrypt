<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />      

</head>
<body>

<div class="container" id = "container">
    <button id="newGame">
        New Game
    </button>
    <button id="giveClues">
        Give Clues
    </button>
    <button class="submit_clue" id="submitClues">
        Submit
    </button>
    <button class="suggest" id="suggestAnswer">
        Suggest
    </button>
    <button class="submitAnswer" id="submitAnswer">
        Submit
    </button>
    <div class="decryptr d-flex mt-4">
        <div class="decryptr--left ">
<!-- team 1 keywords -->
            <div class="decryptr--row">
                <div id="thua_word1" class="keyword1">
                    <span class="m-auto">?</span>
                </div>
            </div>

            <div class="decryptr--row">
                <div id="thua_word2" class="keyword1">
                    <span class="m-auto">?</span>
                </div>
            </div>

            <div class="decryptr--row">
                <div id="thua_word3" class="keyword1">
                    <span class="m-auto">?</span>
                </div>
            </div>

            <div class="decryptr--row">
                <div id="thua_word4" class="keyword1">
                    <span class="m-auto">?</span>
                </div>
            </div>

<!-- team 2 keywords -->
            <div class="decryptr--row">
                <div id="loser_word1" class="decryptr--item2">
                    <span class="m-auto">?</span>
                </div>
            </div>

            <div class="decryptr--row">
                <div id="loser_word2" class="decryptr--item2">
                    <span class="m-auto">?</span>
                </div>
            </div>

            <div class="decryptr--row">
                <div id="loser_word3" class="decryptr--item2">
                    <span class="m-auto">?</span>
                </div>
            </div>

            <div class="decryptr--row">
                <div id="loser_word4" class="decryptr--item2">
                    <span class="m-auto">?</span>
                </div>
            </div>
        </div>

        


        <div class="decryptr--right">
            <div class="decryptr--row" id="row11">
                <div class="box" id="box11"></div>

               
            </div>
            <div class="decryptr--row" id="row12">
                <div class="box" id="box12"></div>
            </div>
            <div class="decryptr--row" id="row13">
                <div class="box" id="box13"></div>
            </div>
            <div class="decryptr--row" id="row14">
                <div class="box" id="box14"> </div>
            </div>
            </div>
        </div>
    </div>
</div>

    <ul id="messages"></ul>
    <form id="form" action="">
      <input id="input" autocomplete="off" /><button>Send</button>
    </form>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
<script src="script.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io();
  
    let my_user_id = "";
    socket.on('connect', function() {
        console.log('connected');
        my_user_id = socket.id;
    });

    // new games: give new html to all users
    var newGames = document.getElementById('newGame');
    newGames.addEventListener('click', function(e) {
        socket.emit('newGames', my_user_id);
    });

    socket.on('newGame_JS', () => {
        console.log('received newGame signal');
        newGame_JS();
    });

    // button for sending giving-clues sinal: client that clicked the button is given
    // the html-change while others have the button greyed out
    var giveClues = document.getElementById('giveClues');
    giveClues.addEventListener('click', function(e) {
        socket.emit('giveClues',my_user_id);
    });

    // received give-clues signal: changes HTML accordingly 
    socket.on('giveClues_JS', (user_id, position_to_be_encoded) => {
        console.log('received giveClues_JS signal');
        if (my_user_id == user_id){
            console.log(my_user_id + ' is giving clues');
            giveClues.setAttribute('disabled', true);
            giveClues_JS(position_to_be_encoded);
        } else {
            console.log('give clues button is greyed out for ' + my_user_id);
            giveClues.setAttribute('disabled', true);
        }
    });

    // button for sending submit-clues signal
    var submitClues = document.getElementById('submitClues');
    submitClues.addEventListener('click', function(e) {
        socket.emit('submitClues', my_user_id, $('#input11').html(), $('#input12').html(), $('#input13').html());
    });

    // received rearrangement singal: clues are now rearranged randomly
    socket.on('rearrangeClues_JS', (user_id, input2_value, input3_value, input1_value, position_to_be_encoded) => {
        if (my_user_id != user_id){
            rearrangeClues_JS(input2_value, input3_value, input1_value, position_to_be_encoded);
        }
    });

    // button to send suggest-arrangement signal to server
    var suggest = document.getElementById('suggestAnswer');
    suggest.addEventListener('click', function(e) {
      
        let box11Children = document.getElementById('box11').children;
        let box12Children = document.getElementById('box12').children;
        let box13Children = document.getElementById('box13').children;
        let box14Children = document.getElementById('box14').children;

        let box11word;
        let box12word;
        let box13word;
        let box14word;

        if (box11Children.length > 0) {
            box11word = box11Children.item(0).innerHTML;} 
        else {
            box11word = 'null';}

        if (box12Children.length > 0) {
            box12word = box12Children.item(0).innerHTML;} 
        else {
            box12word = 'null';}

        if (box13Children.length > 0) {
            box13word = box13Children.item(0).innerHTML;} 
        else {
            box13word = 'null';}

        if (box14Children.length > 0) {
            box14word = box14Children.item(0).innerHTML;} 
        else {
            box14word = 'null';}

        let d = {
            'box11': box11word,
            'box12': box12word,
            'box13': box13word,
            'box14': box14word
            };
        socket.emit('suggestAnswer', my_user_id, d);
    });

    // receive suggest-rearrangement signal, displays for everyone to see
    socket.on('rearrangeSuggest_JS', (user_id, d) => {
        console.log('received rearrangeSuggest_JS ');
        rearrangeSuggest_JS(user_id, d);
    });

    // button for sending submit-answers signal
    var submitAnswer = document.getElementById('submitAnswer');
    submitAnswer.addEventListener('click', function(e) {
        console.log('submitted answer');
        let box11Children = document.getElementById('box11').children;
        let box12Children = document.getElementById('box12').children;
        let box13Children = document.getElementById('box13').children;
        let box14Children = document.getElementById('box14').children;

        let box11word;
        let box12word;
        let box13word;
        let box14word;

        if (box11Children.length > 0) {
            box11word = box11Children.item(0).innerHTML;} 
        else {
            box11word = 'null';}

        if (box12Children.length > 0) {
            box12word = box12Children.item(0).innerHTML;} 
        else {
            box12word = 'null';}

        if (box13Children.length > 0) {
            box13word = box13Children.item(0).innerHTML;} 
        else {
            box13word = 'null';}

        if (box14Children.length > 0) {
            box14word = box14Children.item(0).innerHTML;} 
        else {
            box14word = 'null';}

        let d = {
            'box11': box11word,
            'box12': box12word,
            'box13': box13word,
            'box14': box14word
            };
        console.log(d);
        socket.emit('submitAnswer', my_user_id, d);
    });


    // received communication result, push correct answers to the right
    socket.on('pushRight', (result, user_id, game_state_correct_answer) => {
        console.log('received pushRight');
        pushRight(result, user_id, game_state_correct_answer);
    });




    // chat
    var messages = document.getElementById('messages');
    var form = document.getElementById('form');
    var input = document.getElementById('input');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (input.value) {
        socket.emit('chat message', input.value);
        input.value = '';
        }
    });

    socket.on('chat message', function(msg) {
        var item = document.createElement('li');
        item.textContent = msg;
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
    });

    
  
</script>

</body>
</html>